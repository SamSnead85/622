generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                         String                    @id @default(uuid())
  email                      String                    @unique
  phone                      String?                   @unique
  username                   String                    @unique
  displayName                String
  displayNameSecondary       String?
  secondaryLanguage          String?
  bio                        String?
  website                    String?
  avatarUrl                  String?
  coverUrl                   String?
  passwordHash               String?
  role                       Role                      @default(USER)
  isVerified                 Boolean                   @default(false)
  isPrivate                  Boolean                   @default(false)
  isBanned                   Boolean                   @default(false)
  lastActiveAt               DateTime                  @default(now())
  createdAt                  DateTime                  @default(now())
  updatedAt                  DateTime                  @updatedAt
  resetToken                 String?
  resetTokenExpiry           DateTime?
  twoFactorEnabled           Boolean                   @default(false)
  twoFactorSecret            String?
  twoFactorBackupCodes       String[]
  twoFactorVerifiedAt        DateTime?
  bulletinPosts              BulletinPost[]
  comments                   Comment[]
  createdCommunities         Community[]               @relation("CommunityCreator")
  communityMemberships       CommunityMember[]
  receivedConnectionRequests ConnectionRequest[]       @relation("ReceivedConnectionRequests")
  sentConnectionRequests     ConnectionRequest[]       @relation("SentConnectionRequests")
  conversations              ConversationParticipant[]
  following                  Follow[]                  @relation("Followers")
  followers                  Follow[]                  @relation("Following")
  joinedViaInvite            Invite?                   @relation("JoinedViaInvite")
  sentInvites                Invite[]                  @relation("SentInvites")
  likes                      Like[]
  liveStreams                LiveStream[]
  liveStreamChats            LiveStreamChat[]
  streamSuggestions          LiveStreamSuggestion[]
  sentMessages               Message[]                 @relation("MessageSender")
  migrations                 Migration[]
  moments                    Moment[]
  momentViews                MomentView[]
  notifications              Notification[]
  oauthAccounts              OAuthAccount[]
  matchedConnections         PendingConnection[]       @relation("MatchedConnections")
  importedConnections        PendingConnection[]       @relation("ImportedConnections")
  posts                      Post[]
  rsvps                      PostRSVP[]
  reports                    Report[]
  saves                      Save[]
  sessions                   Session[]
  shares                     Share[]
  subscription               Subscription?
  twoFactorChallenges        TwoFactorChallenge[]
  connectionSettings         UserConnectionSettings?
  interests                  UserInterest[]
  presence                   UserPresence?

  @@index([username])
  @@index([email])
}

model Session {
  id         String   @id @default(uuid())
  userId     String
  token      String   @unique
  deviceType String?
  deviceName String?
  ipAddress  String?
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model TwoFactorChallenge {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model OAuthAccount {
  id           String   @id @default(uuid())
  userId       String
  provider     String
  providerId   String
  accessToken  String?
  refreshToken String?
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerId])
  @@index([userId])
}

model Moment {
  id           String       @id @default(uuid())
  userId       String
  type         MomentType   @default(IMAGE)
  mediaUrl     String
  thumbnailUrl String?
  duration     Int?
  caption      String?
  musicId      String?
  viewCount    Int          @default(0)
  expiresAt    DateTime
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  music        Music?       @relation(fields: [musicId], references: [id])
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  views        MomentView[]

  @@index([userId])
  @@index([expiresAt])
  @@index([createdAt])
}

model MomentView {
  id       String   @id @default(uuid())
  momentId String
  userId   String
  viewedAt DateTime @default(now())
  moment   Moment   @relation(fields: [momentId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([momentId, userId])
  @@index([momentId])
  @@index([userId])
}

model LiveStream {
  id              String           @id @default(uuid())
  userId          String
  title           String
  description     String?
  thumbnailUrl    String?
  streamKey       String           @unique @default(uuid())
  playbackUrl     String?
  status          LiveStreamStatus @default(SCHEDULED)
  viewerCount     Int              @default(0)
  peakViewerCount Int              @default(0)
  totalViews      Int              @default(0)
  startedAt       DateTime?
  endedAt         DateTime?
  scheduledFor    DateTime?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  chatMessages    LiveStreamChat[]

  @@index([userId])
  @@index([status])
  @@index([startedAt])
}

model LiveStreamChat {
  id         String     @id @default(uuid())
  streamId   String
  userId     String
  content    String
  type       ChatType   @default(MESSAGE)
  giftType   String?
  giftAmount Int?
  createdAt  DateTime   @default(now())
  stream     LiveStream @relation(fields: [streamId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([streamId])
  @@index([userId])
  @@index([createdAt])
}

model Follow {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  follower    User     @relation("Followers", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Post {
  id           String        @id @default(uuid())
  userId       String
  communityId  String?
  type         PostType      @default(VIDEO)
  caption      String?
  mediaUrl     String?
  thumbnailUrl String?
  duration     Int?
  musicId      String?
  viewCount    Int           @default(0)
  isPublic     Boolean       @default(true)
  isPinned     Boolean       @default(false)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  comments     Comment[]
  likes        Like[]
  community    Community?    @relation(fields: [communityId], references: [id])
  music        Music?        @relation(fields: [musicId], references: [id])
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  hashtags     PostHashtag[]
  rsvps        PostRSVP[]
  topics       PostTopic[]
  saves        Save[]
  shares       Share[]

  @@index([userId])
  @@index([communityId])
  @@index([createdAt])
}

model Music {
  id         String   @id @default(uuid())
  title      String
  artist     String
  audioUrl   String
  duration   Int
  coverUrl   String?
  usageCount Int      @default(0)
  createdAt  DateTime @default(now())
  moments    Moment[]
  posts      Post[]

  @@index([title])
  @@index([artist])
}

model Comment {
  id         String    @id @default(uuid())
  postId     String
  userId     String
  parentId   String?
  content    String
  likesCount Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  parent     Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies    Comment[] @relation("CommentReplies")
  post       Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([userId])
  @@index([parentId])
}

model Like {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([postId])
}

model Share {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model Save {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([userId])
}

model PostRSVP {
  id        String     @id @default(uuid())
  postId    String
  userId    String
  status    RSVPStatus @default(IN)
  createdAt DateTime   @default(now())
  post      Post       @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([postId])
}

model Hashtag {
  id         String        @id @default(uuid())
  name       String        @unique
  usageCount Int           @default(0)
  createdAt  DateTime      @default(now())
  posts      PostHashtag[]

  @@index([name])
}

model PostHashtag {
  id        String  @id @default(uuid())
  postId    String
  hashtagId String
  hashtag   Hashtag @relation(fields: [hashtagId], references: [id], onDelete: Cascade)
  post      Post    @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, hashtagId])
}

model Community {
  id          String            @id @default(uuid())
  creatorId   String
  name        String            @unique
  slug        String            @unique
  description String?
  avatarUrl   String?
  coverUrl    String?
  isPublic    Boolean           @default(true)
  memberCount Int               @default(0)
  postCount   Int               @default(0)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  creator     User              @relation("CommunityCreator", fields: [creatorId], references: [id])
  members     CommunityMember[]
  rules       CommunityRule[]
  posts       Post[]

  @@index([name])
  @@index([slug])
}

model CommunityMember {
  id          String        @id @default(uuid())
  userId      String
  communityId String
  role        CommunityRole @default(MEMBER)
  joinedAt    DateTime      @default(now())
  community   Community     @relation(fields: [communityId], references: [id], onDelete: Cascade)
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, communityId])
  @@index([communityId])
}

model CommunityRule {
  id          String    @id @default(uuid())
  communityId String
  title       String
  description String
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  community   Community @relation(fields: [communityId], references: [id], onDelete: Cascade)

  @@index([communityId])
}

model Conversation {
  id           String                    @id @default(uuid())
  isGroup      Boolean                   @default(false)
  groupName    String?
  groupAvatar  String?
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  participants ConversationParticipant[]
  messages     Message[]
}

model ConversationParticipant {
  id             String       @id @default(uuid())
  conversationId String
  userId         String
  lastReadAt     DateTime     @default(now())
  isMuted        Boolean      @default(false)
  joinedAt       DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([userId])
}

model Message {
  id             String        @id @default(uuid())
  conversationId String
  senderId       String
  content        String
  mediaUrl       String?
  mediaType      MessageMedia?
  isEdited       Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  conversation   Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User          @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@index([createdAt])
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  actorId   String?
  targetId  String?
  message   String
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model Migration {
  id                 String              @id @default(uuid())
  userId             String
  platform           MigrationPlatform
  status             MigrationStatus     @default(PENDING)
  filePath           String?
  stats              Json?
  errorMessage       String?
  createdAt          DateTime            @default(now())
  startedAt          DateTime?
  completedAt        DateTime?
  importedPosts      ImportedPost[]
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  pendingConnections PendingConnection[]

  @@index([userId])
  @@index([status])
}

model ImportedPost {
  id                String       @id @default(uuid())
  migrationId       String
  originalPlatform  String
  originalId        String?
  originalTimestamp DateTime?
  type              PostType     @default(IMAGE)
  caption           String?
  mediaUrls         String[]
  location          String?
  tags              String[]
  importStatus      ImportStatus @default(PENDING)
  caravanPostId     String?
  errorMessage      String?
  createdAt         DateTime     @default(now())
  migration         Migration    @relation(fields: [migrationId], references: [id], onDelete: Cascade)

  @@index([migrationId])
  @@index([importStatus])
}

model PendingConnection {
  id               String            @id @default(uuid())
  userId           String
  migrationId      String?
  platform         MigrationPlatform
  originalUsername String
  displayName      String?
  profileImageUrl  String?
  email            String?
  phone            String?
  matchedUserId    String?
  matchConfidence  Int?
  connectionType   ConnectionType    @default(FOLLOWER)
  inviteStatus     InviteStatus      @default(NOT_SENT)
  inviteSentAt     DateTime?
  inviteMethod     InviteMethod?
  createdAt        DateTime          @default(now())
  matchedUser      User?             @relation("MatchedConnections", fields: [matchedUserId], references: [id])
  migration        Migration?        @relation(fields: [migrationId], references: [id])
  user             User              @relation("ImportedConnections", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([inviteStatus])
  @@index([originalUsername])
}

model Invite {
  id             String       @id @default(uuid())
  senderId       String
  recipientEmail String?
  recipientPhone String?
  method         InviteMethod
  status         InviteStatus @default(SENT)
  referralCode   String       @unique
  message        String?
  createdAt      DateTime     @default(now())
  sentAt         DateTime     @default(now())
  openedAt       DateTime?
  joinedAt       DateTime?
  joinedUserId   String?      @unique
  joinedUser     User?        @relation("JoinedViaInvite", fields: [joinedUserId], references: [id])
  sender         User         @relation("SentInvites", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([referralCode])
  @@index([status])
}

model Territory {
  id                        String                      @id @default(uuid())
  name                      String
  slug                      String                      @unique
  description               String?
  type                      TerritoryType
  avatarUrl                 String?
  coverUrl                  String?
  primaryColor              String?                     @default("#D4AF37")
  isPublic                  Boolean                     @default(false)
  requireApproval           Boolean                     @default(true)
  parentId                  String?
  memberCount               Int                         @default(0)
  postCount                 Int                         @default(0)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  contentModerationSettings ContentModerationSettings?
  geoBlocks                 GeoBlock[]
  parent                    Territory?                  @relation("TerritoryHierarchy", fields: [parentId], references: [id])
  children                  Territory[]                 @relation("TerritoryHierarchy")
  algorithmSettings         TerritoryAlgorithmSettings?
  outgoingConnections       TerritoryConnection[]       @relation("ConnectionFrom")
  incomingConnections       TerritoryConnection[]       @relation("ConnectionTo")
  members                   TerritoryMember[]
  moderationRules           TerritoryModerationRule[]
  posts                     TerritoryPost[]
  strikes                   TerritoryStrike[]

  @@index([type])
  @@index([parentId])
  @@index([slug])
}

model TerritoryMember {
  id          String        @id @default(uuid())
  territoryId String
  userId      String
  role        TerritoryRole @default(MEMBER)
  joinedAt    DateTime      @default(now())
  invitedById String?
  isMuted     Boolean       @default(false)
  strikeCount Int           @default(0)
  territory   Territory     @relation(fields: [territoryId], references: [id], onDelete: Cascade)

  @@unique([territoryId, userId])
  @@index([userId])
  @@index([territoryId])
}

model TerritoryPost {
  id          String    @id @default(uuid())
  territoryId String
  postId      String
  sharedById  String
  createdAt   DateTime  @default(now())
  territory   Territory @relation(fields: [territoryId], references: [id], onDelete: Cascade)

  @@unique([territoryId, postId])
  @@index([territoryId])
}

model TerritoryConnection {
  id              String                  @id @default(uuid())
  fromTerritoryId String
  toTerritoryId   String
  type            TerritoryConnectionType @default(OBSERVED)
  shareContent    Boolean                 @default(false)
  shareMembers    Boolean                 @default(false)
  status          ConnectionStatus        @default(PENDING)
  requestedAt     DateTime                @default(now())
  approvedAt      DateTime?
  fromTerritory   Territory               @relation("ConnectionFrom", fields: [fromTerritoryId], references: [id], onDelete: Cascade)
  toTerritory     Territory               @relation("ConnectionTo", fields: [toTerritoryId], references: [id], onDelete: Cascade)

  @@unique([fromTerritoryId, toTerritoryId])
  @@index([fromTerritoryId])
  @@index([toTerritoryId])
}

model TerritoryAlgorithmSettings {
  id                String         @id @default(uuid())
  territoryId       String         @unique
  recencyWeight     Int            @default(50)
  engagementWeight  Int            @default(30)
  familiarityWeight Int            @default(60)
  noveltyWeight     Int            @default(20)
  contentRatings    String[]       @default(["G", "PG", "PG13"])
  whoCanPost        PostPermission @default(MEMBERS)
  whoCanComment     PostPermission @default(MEMBERS)
  whoCanInvite      PostPermission @default(ELDERS)
  allowCrossPosting Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  territory         Territory      @relation(fields: [territoryId], references: [id], onDelete: Cascade)
}

model TerritoryModerationRule {
  id          String     @id @default(uuid())
  territoryId String
  title       String
  description String
  type        RuleType
  keywords    String[]   @default([])
  action      RuleAction @default(FLAG)
  isActive    Boolean    @default(true)
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  territory   Territory  @relation(fields: [territoryId], references: [id], onDelete: Cascade)

  @@index([territoryId])
}

model TerritoryStrike {
  id          String    @id @default(uuid())
  territoryId String
  userId      String
  issuedById  String
  reason      String
  postId      String?
  expiresAt   DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  territory   Territory @relation(fields: [territoryId], references: [id], onDelete: Cascade)

  @@index([territoryId])
  @@index([userId])
}

model GeoBlock {
  id          String       @id @default(uuid())
  territoryId String?
  countryCode String
  countryName String
  reason      String?
  blockType   GeoBlockType @default(FULL)
  createdById String
  createdAt   DateTime     @default(now())
  expiresAt   DateTime?
  territory   Territory?   @relation(fields: [territoryId], references: [id], onDelete: Cascade)

  @@unique([territoryId, countryCode])
  @@index([countryCode])
  @@index([territoryId])
}

model ContentModerationSettings {
  id                      String    @id @default(uuid())
  territoryId             String    @unique
  explicitLanguageFilter  Boolean   @default(false)
  explicitMaterialsFilter Boolean   @default(false)
  aiModerationEnabled     Boolean   @default(true)
  aiSensitivity           Int       @default(50)
  blockedWords            String[]  @default([])
  flaggedWords            String[]  @default([])
  minContentRating        String    @default("G")
  maxContentRating        String    @default("PG13")
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  territory               Territory @relation(fields: [territoryId], references: [id], onDelete: Cascade)
}

model PlatformSecurityPolicy {
  id          String             @id @default(uuid())
  name        String             @unique
  description String?
  isActive    Boolean            @default(true)
  type        SecurityPolicyType
  config      Json               @default("{}")
  createdById String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  @@index([type])
  @@index([isActive])
}

model BlockedIP {
  id          String      @id @default(uuid())
  ipAddress   String      @unique
  reason      String?
  threatLevel ThreatLevel @default(MEDIUM)
  source      String?
  createdById String?
  createdAt   DateTime    @default(now())
  expiresAt   DateTime?

  @@index([expiresAt])
}

model SecurityAuditLog {
  id          String      @id @default(uuid())
  action      String
  userId      String?
  ipAddress   String
  countryCode String?
  userAgent   String?
  details     Json?
  severity    ThreatLevel @default(LOW)
  createdAt   DateTime    @default(now())

  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@index([ipAddress])
}

model BulletinPost {
  id           String            @id @default(uuid())
  type         BulletinType
  title        String
  content      String
  mediaUrl     String?
  externalLink String?
  upvotes      Int               @default(0)
  downvotes    Int               @default(0)
  viewCount    Int               @default(0)
  category     BulletinCategory
  tags         String[]
  isPinned     Boolean           @default(false)
  isVerified   Boolean           @default(false)
  location     String?
  locationGeo  String?
  eventDate    DateTime?
  authorId     String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  expiresAt    DateTime?
  comments     BulletinComment[]
  author       User              @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([type])
  @@index([category])
  @@index([authorId])
  @@index([createdAt])
  @@index([isPinned])
}

model BulletinComment {
  id         String       @id @default(uuid())
  content    String
  bulletinId String
  authorId   String
  createdAt  DateTime     @default(now())
  bulletin   BulletinPost @relation(fields: [bulletinId], references: [id], onDelete: Cascade)

  @@index([bulletinId])
  @@index([authorId])
  @@index([createdAt])
}

model BulletinVote {
  id         String   @id @default(uuid())
  bulletinId String
  userId     String
  isUpvote   Boolean
  createdAt  DateTime @default(now())

  @@unique([bulletinId, userId])
  @@index([bulletinId])
  @@index([userId])
}

model LiveStreamSuggestion {
  id            String           @id @default(uuid())
  platformType  StreamPlatform
  externalId    String
  embedUrl      String
  title         String
  thumbnailUrl  String?
  description   String?
  upvotes       Int              @default(0)
  downvotes     Int              @default(0)
  status        SuggestionStatus @default(PENDING)
  suggestedById String
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  suggestedBy   User             @relation(fields: [suggestedById], references: [id], onDelete: Cascade)
  votes         StreamVote[]

  @@index([status])
  @@index([platformType])
  @@index([suggestedById])
  @@index([createdAt])
}

model StreamVote {
  id           String               @id @default(uuid())
  suggestionId String
  userId       String
  isUpvote     Boolean
  createdAt    DateTime             @default(now())
  suggestion   LiveStreamSuggestion @relation(fields: [suggestionId], references: [id], onDelete: Cascade)

  @@unique([suggestionId, userId])
  @@index([suggestionId])
  @@index([userId])
}

model ConnectionRequest {
  id         String           @id @default(uuid())
  senderId   String
  receiverId String
  status     ConnectionStatus @default(PENDING)
  message    String?
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  receiver   User             @relation("ReceivedConnectionRequests", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User             @relation("SentConnectionRequests", fields: [senderId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([senderId])
  @@index([receiverId])
  @@index([status])
}

model UserConnectionSettings {
  id          String  @id @default(uuid())
  userId      String  @unique
  autoApprove Boolean @default(false)
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserPresence {
  id          String   @id @default(uuid())
  userId      String   @unique
  isOnline    Boolean  @default(true)
  lastSeenAt  DateTime @default(now())
  currentPage String?
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isOnline])
  @@index([lastSeenAt])
}

model Subscription {
  id                   String             @id @default(uuid())
  userId               String             @unique
  stripeCustomerId     String?
  stripeSubscriptionId String?
  stripePriceId        String?
  status               SubscriptionStatus @default(INACTIVE)
  currentPeriodEnd     DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([stripeCustomerId])
  @@index([status])
}

model Report {
  id         String       @id @default(uuid())
  reporterId String
  targetId   String
  targetType ReportType
  reason     String
  status     ReportStatus @default(PENDING)
  notes      String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  reporter   User         @relation(fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([targetType])
  @@index([createdAt])
}

model Topic {
  id            String         @id @default(uuid())
  slug          String         @unique
  name          String
  description   String?
  icon          String?
  color         String?
  postCount     Int            @default(0)
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  posts         PostTopic[]
  userInterests UserInterest[]

  @@index([slug])
  @@index([postCount])
}

model PostTopic {
  id      String @id @default(uuid())
  postId  String
  topicId String
  post    Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
  topic   Topic  @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@unique([postId, topicId])
  @@index([postId])
  @@index([topicId])
}

model UserInterest {
  id        String        @id @default(uuid())
  userId    String
  topicId   String
  level     InterestLevel @default(INTERESTED)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  topic     Topic         @relation(fields: [topicId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, topicId])
  @@index([userId])
  @@index([topicId])
  @@index([level])
}

enum Role {
  USER
  MODERATOR
  ADMIN
  SUPERADMIN
}

enum MomentType {
  IMAGE
  VIDEO
  TEXT
}

enum LiveStreamStatus {
  SCHEDULED
  LIVE
  ENDED
  CANCELLED
}

enum ChatType {
  MESSAGE
  GIFT
  REACTION
  JOIN
  LEAVE
}

enum PostType {
  IMAGE
  VIDEO
  TEXT
  POLL
  RALLY
}

enum RSVPStatus {
  IN
  MAYBE
  OUT
}

enum CommunityRole {
  MEMBER
  MODERATOR
  ADMIN
}

enum MessageMedia {
  IMAGE
  VIDEO
  AUDIO
  FILE
}

enum NotificationType {
  LIKE
  COMMENT
  FOLLOW
  MENTION
  COMMUNITY_INVITE
  COMMUNITY_POST
  MESSAGE
  SYSTEM
  WAVE
}

enum MigrationPlatform {
  INSTAGRAM
  TIKTOK
  TWITTER
  FACEBOOK
  WHATSAPP
}

enum MigrationStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum ImportStatus {
  PENDING
  IMPORTING
  COMPLETED
  SKIPPED
  FAILED
}

enum ConnectionType {
  FOLLOWER
  FOLLOWING
  MUTUAL
  CONTACT
}

enum InviteStatus {
  NOT_SENT
  SENT
  REMINDED
  OPENED
  JOINED
  DECLINED
  BOUNCED
}

enum InviteMethod {
  EMAIL
  SMS
  LINK
}

enum TerritoryType {
  CIRCLE
  CLAN
  TRIBE
  NATION
  WORLD
}

enum TerritoryRole {
  MEMBER
  GUARDIAN
  ELDER
  CHIEF
}

enum TerritoryConnectionType {
  ALLIED
  FEDERATED
  OBSERVED
  BLOCKED
}

enum ConnectionStatus {
  PENDING
  APPROVED
  REJECTED
  ACCEPTED
  DECLINED
  BLOCKED
}

enum PostPermission {
  ANYONE
  MEMBERS
  GUARDIANS
  ELDERS
  CHIEFS
}

enum RuleType {
  KEYWORD_FILTER
  CONTENT_RATING
  SPAM_DETECTION
  CUSTOM
}

enum RuleAction {
  FLAG
  HIDE
  DELETE
  WARN
  STRIKE
}

enum GeoBlockType {
  FULL
  VIEW_ONLY
  NO_JOIN
}

enum SecurityPolicyType {
  RATE_LIMITING
  IP_BLOCKING
  GEO_RESTRICTION
  CONTENT_SCANNING
  AUTH_HARDENING
  DATA_PROTECTION
  THREAT_DETECTION
}

enum ThreatLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum BulletinType {
  ANNOUNCEMENT
  JOB
  COLLABORATION
  INVESTMENT
  EVENT
  CALL_TO_ACTION
  SPOTLIGHT
  DISCUSSION
}

enum BulletinCategory {
  SOCIAL_JUSTICE
  CAREER
  BUSINESS
  COMMUNITY
  CULTURE
  TECH
  ACTIVISM
  GENERAL
}

enum StreamPlatform {
  YOUTUBE
  TWITCH
  FACEBOOK
  INSTAGRAM
  TIKTOK
  NATIVE
}

enum SuggestionStatus {
  PENDING
  APPROVED
  LIVE
  ENDED
  REJECTED
}

enum SubscriptionStatus {
  active
  canceled
  incomplete
  incomplete_expired
  past_due
  paused
  trialing
  unpaid
  INACTIVE
}

enum ReportType {
  POST
  USER
  COMMENT
  COMMUNITY
  LIVESTREAM
  MESSAGE
}

enum ReportStatus {
  PENDING
  REVIEWING
  RESOLVED
  DISMISSED
}

enum InterestLevel {
  NOT_INTERESTED
  INTERESTED
  VERY_INTERESTED
}
